<!DOCTYPE html>
<html lang="ru">
<head>
	<title>Глубокое погружение в webpack</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=792, user-scalable=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<link rel="stylesheet" href="shower/themes/bright/styles/screen.css">
	<link rel="stylesheet" href="assets/styles.css">
</head>
<body class="full">

<div id="log" style="position: absolute; z-index: 100;"></div>

<header class="caption">
	<h1>Глубокое погружение в webpack</h1>

	<p>Владимир Кузнецов (<a href="https://twitter.com/mistakster">@mistakster</a>), Graph</p>
</header>

<section class="slide intro shout" id="intro">
	<div>
		<h3>Глубокое погружение в&nbsp;webpack</h3>
		<p>
			Владимир Кузнецов,
			<a target="_blank" href="https://twitter.com/mistakster">@mistakster</a>,
			Graph
		</p>
		<p>FrontTalks, сентябрь 2015</p>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Для чего нужен webpack?</h2>
	</div>
</section>

<section class="slide cover w" style="background-color: white">
	<div>
		<h2 style="font-size: 150px; text-align: center; position: absolute; width: 100%; left: 0; top: 50%; transform: translateX(0) translateY(-50%)">
			<span style="display: none">Grunt и Gulp</span> vs. <span style="display: none">webpack</span>
		</h2>
		<img src="assets/gg-vs-webpack.png" alt="Grunt и Gulp vs. webpack">
	</div>
</section>

<section class="slide shout shrink">
	<div>
		<h2>Это не просто &laquo;taks&nbsp;runner&raquo;</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Что полезного он нам даёт?</h2>
		<ul>
			<li class="next">автоматически строит дерево зависимостей ресурсов;</li>
			<li class="next">упаковывает модули, которые могут быть загружены &laquo;лениво&raquo;, в&nbsp;отдельные файлы;</li>
			<li class="next">выполняет оптимизацию кода;</li>
			<li class="next">может делать &laquo;горячую&raquo; замену модулей на странице.</li>
		</ul>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Дерево зависимостей</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Пример с CommonJS модулями</h2>
		<pre>
			<code>var shuffle = require(&quot;lodash/collection/shuffle&quot;);</code>
			<code>var camelCase = require(&quot;lodash/string/camelCase&quot;);</code>
			<code>module.exports = function (list) {</code>
			<code>  return shuffle(list).map(camelCase);</code>
			<code>};</code>
		</pre>
	</div>
</section>

<section class="slide cover w h video-player" style="background-color: white">
	<div>
		<video preload="auto" loop>
			<source src="assets/app-simple-tree.mp4" type="video/mp4">
		</video>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Зависимостями могут быть&nbsp;любые&nbsp;файлы</h2>
		<ul>
			<li>ES2015, JSX, TypeScript, &hellip;</li>
			<li>CSS, LESS, SASS, Stylus, &hellip;</li>
			<li>PNG, JPEG, SVG, WOFF, &hellip;</li>
			<li>Handlebars, Jade, &hellip;</li>
		</ul>
	</div>
</section>

<section class="slide cover w h video-player" style="background-color: white">
	<div>
		<video preload="auto" loop>
			<source src="assets/app-dep-tree.mp4" type="video/mp4">
		</video>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Загрузчики и&nbsp;плагины</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Загрузчки</h2>
		<ul>
			<li>преобразуют данные из одного формата в другой;</li>
			<li>могут добавлять в упаковку другие модули;</li>
			<li>как правило, делают одну трансформацию;</li>
			<li>работают только с одним модулем.</li>
		</ul>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Плагины</h2>
		<ul>
			<li>имеют доступ ко всем модулям (до и после трансформации);</li>
			<li>могут добавлять в упаковку свои модули (например, &laquo;runtime&raquo;);</li>
			<li>имеют доступ ко всем ресурсам, создаваемым после упаковки.</li>
			<li>применяются для изменения конфигурации сборки, оптимизации, добавления
				в&nbsp;модули каких-то объектов, горячего обновления ресурсов.</li>
		</ul>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Конфигурация webpack</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Конфигурация webpack</h2>
		<pre>
			<code>module.exports = {</code>
			<code>  entry: &quot;./app.js&quot;,</code>
			<code>  output: {</code>
        	<code>    path: __dirname + &quot;/output&quot;,</code>
        	<code>    filename: &quot;app.bundle.js&quot;</code>
    		<code>  }</code>
    		<code>};</code>
		</pre>
	</div>
</section>

<section class="slide cover h">
	<div>
		<span class="next config-part-1"></span>
		<span class="next config-part-2"></span>
		<span class="next config-part-3"></span>
		<span class="next config-part-4"></span>
		<span class="next config-part-5"></span>
		<span class="next config-part-6"></span>
		<span class="next config-part-7"></span>
		<span class="next config-full"></span>
		<img src="assets/real-config.png" class="config" alt="Конфигурация webpack">
	</div>
</section>

<section class="slide">
	<div>
		<h2>Файл конфигурации</h2>
		<p>Явно указываем файл конфигурации</p>
		<pre>
			<code>$ webpack --config ./configs/site.js</code>
			<code>$ webpack --config ./configs/admin.js</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Обнаружение общих модулей</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Несколько точек входа</h2>
		<pre>
			<code>entry: {</code>
			<code>  &quot;site&quot;: &quot;./site&quot;,</code>
			<code>  &quot;admin&quot;: &quot;./admin&quot;</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Параметры финальной упаковки</h2>
		<pre>
			<code>output: {</code>
			<code>  path: require(&quot;path&quot;).resolve(&quot;./public/_/&quot;),</code>
			<code>  publicPath: &quot;/assets/&quot;,</code>
			<code>  filename: &quot;[name].js&quot;,</code>
			<code>  chunkFilename: &quot;[id].js&quot;</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Обнаружение общих модулей</h2>
		<pre>
			<code>plugins: [</code>
			<code>  new webpack.optimize.CommonsChunkPlugin({</code>
			<code>    name: &quot;commons&quot;,</code>
			<code>    filename: &quot;[name].js&quot;</code>
			<code>  })</code>
			<code>]</code>
		</pre>
	</div>
</section>

<section class="slide cover w h" style="background-color: white">
	<div>
		<span class="next common-chunk-1"></span>
		<span class="next common-chunk-full"></span>
		<img src="assets/extract-common-chunk.png" class="common-chunk">
	</div>
</section>

<section class="slide">
	<div>
		<h2>Общая часть</h2>
		<pre>
			<code>&lt-- site.html --></code>
			<code>&ltscript src=&quot;/assets/commons.js&quot;>&lt;/script></code>
			<code>&ltscript src=&quot;/assets/site.js&quot;>&lt;/script></code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Автоматическое разделение кода и&nbsp;асинхронная загрузка частей</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Code splitting</h2>
		<pre>
			<code>require.ensure([&quot;jquery&quot;, &quot;lodash&quot;],</code>
			<code>  function (require) {</code>
			<code>    var jQuery = require(&quot;jquery&quot;);</code>
			<code>  }</code>
			<code>);</code>
		</pre>
	</div>
</section>

<section class="slide cover w" style="background-color: white">
	<div>
		<span class="next loader-1"></span>
		<span class="next loader-2"></span>
		<span class="next loader-full"></span>
		<img src="assets/main-and-chunks.png" class="loader">
		<a class="move-to-https" target="_blank" href="http://mistakster.github.io/4front-move-to-https/">
			Переходи на HTTPS!
		</a>
	</div>
</section>

<section class="slide">
	<div>
		<h2>bundle-loader</h2>
		<pre>
			<code>var waitForChunk = require('bundle!./page');</code>
			<code>waitForChunk(function (page) {</code>
			<code>  page.init();</code>
			<code>});</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>bundle-loader</h2>
		<pre>
			<code>var waitForChunk = require(&quot;bundle?<mark>lazy</mark>!./page&quot;);</code>
			<code><mark class="comment">/* много очень нужного кода */</mark></code>
			<code>waitForChunk(function (page) {</code>
			<code>  page.init();</code>
			<code>});</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Подавляем ненужные ресурсы</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Контекст</h2>
		<pre>
			<code><mark class="comment">// moment.js</mark></code>
			<code>require(&quot;./locale/&quot; + name);</code>
		</pre>
		<p>
			Папка &mdash; <code>./locale</code><br>
			Регулярное выражение &mdash; <code>/^.*$/</code>
		</p>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Подавляем ненужные ресурсы</h2>
		<pre>
			<code>plugins: [</code>
			<code>  new webpack.ContextReplacementPlugin(</code>
			<code>    /moment[\/\\]locale$/,</code>
			<code>    /^(en-gb|ru)\.js$/</code>
			<code>  )</code>
			<code>]</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Плагины для оптимизации упаковки</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Плагины для оптимизации упаковки</h2>
		<ul>
			<li>DedupePlugin</li>
			<li>OccurenceOrderPlugin</li>
			<li>UglifyJsPlugin</li>
		</ul>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Глобальные переменные</h2>
		<pre>
			<code>new webpack.DefinePlugin({</code>
			<code>  &quot;DEBUG&quot;: process.env.NODE_ENV != &quot;production&quot;,</code>
			<code>  &quot;API_ENDPOINT&quot;: &quot;'&quot; + URL + &quot;'&quot;,</code>
			<code>  &quot;helloWorldFunc&quot;: function () {</code>
			<code>    return 'Hello, world!';</code>
			<code>  }</code>
			<code>})</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Глобальные переменные</h2>
		<div style="display: table; width: 100%;">
			<div style="display: table-cell; padding-right: 72px;">
				<pre>
					<code>if (DEBUG) {</code>
					<code> alert(API_ENDPOINT);</code>
					<code>}</code>
					<code>helloWorldFunc();</code>
				</pre>
			</div>
			<div style="display: table-cell;">
				<pre>
					<code>if (false) {</code>
					<code> alert(('http://example.com'));</code>
					<code>}</code>
					<code>(function () {</code>
					<code> return 'Hello, world!';</code>
					<code>})();</code>
				</pre>
			</div>
		</div>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Сервер для разработки и&nbsp;горячее обновление</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Сервер для разработки</h2>
		<pre>
			<code>$ npm i -g webpack-dev-server</code>
			<code>$ webpack-dev-server</code>
		</pre>
		<p>Можно встроить в&nbsp;существующий сервер на&nbsp;Node.js или
			пробросить доступ к&nbsp;нему через прокси-сервер.</p>
	</div>
</section>

<section class="slide cover h w video-player">
	<div>
		<video preload="auto" loop>
			<source src="assets/dev-server.mp4" type="video/mp4">
		</video>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Извлечение стилей из&nbsp;упаковки</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Стили на страницу добавляются динамически</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Конфигурируем плагин</h2>
		<pre>
			<code>var ExtractText = require(&quot;extract-text-webpack-plugin&quot;);</code>
			<code>var extractStyles = new ExtractText(&quot;site.css&quot;);</code>
			<code>var loader = extractStyles.extract(&quot;style&quot;, &quot;css!less&quot;);</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Добавляем плагин и загрузчик</h2>
		<pre>
			<code>plugins: [ extractStyles ]</code>
			<code>module: {</code>
			<code>  loaders: [</code>
			<code>    { test: /\.less$/, loader: loader }</code>
			<code>  ]</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Бонус: запуск&nbsp;задач</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Запуск задач плагином</h2>
		<pre>
			<code>var MyTaskRunner = function () {};</code>
			<code>MyTaskRunner.prototype.apply = function (compiler) {</code>
			<code>  <mark class="comment">// задачи</mark></code>
			<code>}</code>
			<code>module.exports = MyTaskRunner;</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Запуск задач плагином</h2>
		<pre>
			<code>compiler.plugin(&quot;run&quot;, function (params, callback) {</code>
			<code>  console.log(&quot;*** Run ***&quot;);</code>
			<code>  callback();</code>
			<code>});</code>
			<code>compiler.plugin(&quot;done&quot;, function () {</code>
			<code>  console.log(&quot;*** Done ***&quot;);</code>
			<code>});</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Запуск задач</h2>
		<pre>
			<code>$ npm run clean</code>
		</pre>
		<pre>
			<code>&quot;scripts&quot;: {</code>
			<code>  &quot;clean&quot;: &quot;rm -rf ./public/_&quot;</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Запуск задач</h2>
		<pre>
			<code>$ npm run build:site</code>
			<code>$ npm run build:admin</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>$ npm run build:site</h2>
		<pre>
			<code>&quot;scripts&quot;: {</code>
			<code>  &quot;build:site&quot;: &quot;./node_modules/.bin/webpack --config site&hellip;</code>
			<code>  &quot;build:admin&quot;: &quot;./node_modules/.bin/webpack &hellip;</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Запуск задач</h2>
		<pre>
			<code>$ npm run myCoolJavaScript</code>
		</pre>
		<pre>
			<code>&quot;scripts&quot;: {</code>
			<code>  &quot;myCoolJavaScript&quot;: &quot;node my-cool-javascript.js&quot;</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Заключение</h2>
	</div>
</section>

<section class="slide shout cover w">
	<div>
		<h2 style="margin-bottom: 0; margin-top: 150px; text-align: center">С погружением!</h2>
		<img src="assets/diver.jpg" align="Водолаз">
	</div>
</section>

<section class="slide" id="contacts">
	<div>
		<h2>Владимир Кузнецов</h2>
		<p>
			<img src="assets/twitter.svg" class="icon">
			<a href="http://twitter.com/mistakster" target="_blank">@mistakster</a> (English)<br>
			<img src="assets/twitter.svg" class="icon">
			<a href="http://twitter.com/mista_k" target="_blank">@mista_k</a> (больше про жизнь)
		</p>
		<p>
			<img src="assets/globe.svg" class="icon">
			<a href="http://noteskeeper.ru" target="_blank">noteskeeper.ru</a>
		</p>
		<p>
			Слайды презентации:
			<a href="http://mistakster.github.io/fronttalks-webpack/">mistakster.github.io/fronttalks-webpack</a>
		</p>
	</div>
</section>

<div class="progress"><div></div></div>

<script src="shower/shower.min.js"></script>
<script src="assets/video-player.js"></script>
<!-- Copyright © 2015 Владимир Кузнецов -->
</body>
</html>
