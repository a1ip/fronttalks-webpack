<!DOCTYPE html>
<html lang="ru">
<head>
	<title>Глубокое погружение в webpack</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=792, user-scalable=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<link rel="stylesheet" href="shower/themes/bright/styles/screen.css">
	<link rel="stylesheet" href="assets/styles.css">
</head>
<body class="full">

<header class="caption">
	<h1>Глубокое погружение в webpack</h1>

	<p>Владимир Кузнецов (<a href="https://twitter.com/mistakster">@mistakster</a>), Graph</p>
</header>

<section class="slide intro shout" id="intro">
	<div>
		<h3>Глубокое погружение в webpack</h3>
		<p>
			Владимир Кузнецов,
			<a target="_blank" href="https://twitter.com/mistakster">@mistakster</a>,
			Graph
		</p>
		<p>FrontTalks, сентябрь 2015</p>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Для чего нужен webpack?</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Для чего нужен webpack?</h2>
		<ol>
			<li>создание упаковок из JavaScript-модулей;</li>
			<li class="next">преобразование ресурсов из одного формата в другой;</li>
			<li class="next">запуск задач через загрузчики или плагины.</li>
		</ol>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Форматы модулей</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>CommonJS</h2>
		<ul>
			<li>один файл &mdash; один модуль;</li>
			<li>синхронная загрузка модулей;</li>
			<li>код модулей не&nbsp;может быть исполнен в&nbsp;браузере без модификаций&nbsp;&mdash;
				формат разрабатывался исключительно для&nbsp;выполнения на&nbsp;сервере или внутри приложения.</li>
		</ul>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Пример CommonJS</h2>
		<pre>
			<code>var shuffle = require("lodash/collection/shuffle");</code>
			<code>var camelCase = require("lodash/string/camelCase");</code>
			<code>module.exports = function (list) {</code>
			<code>  return shuffle(list).map(camelCase);</code>
			<code>};</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>AMD (Asynchronous Module Definition)</h2>
		<ul>
			<li>код может исполнятся в браузере без модификаций;</li>
			<li>модуль может использоваться как обёртка для CommonJS-модуля;</li>
			<li>возможна асинхронная загрузка модулей;</li>
			<li>модуль может зависеть от данных любых типов&nbsp;&mdash;<br>текст, шаблоны, стили и т.п.</li>
		</ul>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Пример AMD</h2>
		<pre>
			<code>define(["lodash/collection/shuffle",</code>
			<code>        "lodash/string/camelCase"],</code>
			<code>  function (shuffle, camelCase) {</code>
			<code>    return function (list) {</code>
			<code>      return shuffle(list).map(camelCase);</code>
			<code>    };</code>
			<code>  });</code>
		</pre>
	</div>
</section>

<section class="slide cover w h" style="background-color: white">
	<div>
		<h2>Webpack строит дерево зависимостей</h2>
		<img src="assets/dependencies-tree.svg" style="width: 80%; height: 80%; top: 20%; left: 10%;">
	</div>
</section>

<section class="slide">
	<div>
		<h2>Зависимостями могут быть&nbsp;любые&nbsp;файлы</h2>
		<ul>
			<li>ES2015, JSX, TypeScript, &hellip;</li>
			<li>CSS, LESS, SASS, Stylus, &hellip;</li>
			<li>PNG, JPEG, SVG, &hellip;</li>
			<li>Handlebars, Jade, &hellip;</li>
		</ul>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Конфигурация webpack</h2>
		<pre>
			<code>module.exports = {</code>
			<code>  entry: &quot;./app.js&quot;,</code>
			<code>  output: {</code>
        	<code>    path: __dirname + &quot;/output&quot;,</code>
        	<code>    filename: &quot;app.bundle.js&quot;</code>
    		<code>  }</code>
    		<code>};</code>
		</pre>
	</div>
</section>

<section class="slide cover h">
	<div>
		<span class="next config-part-1"></span>
		<span class="next config-part-2"></span>
		<span class="next config-part-3"></span>
		<span class="next config-part-4"></span>
		<span class="next config-part-5"></span>
		<span class="next config-part-6"></span>
		<span class="next config-part-7"></span>
		<span class="next config-full"></span>
		<img src="assets/real-config.png" class="config" alt="Конфигурация webpack">
	</div>
</section>

<section class="slide">
	<div>
		<h2>Файл конфигурации</h2>
		<p>Явно указываем файл конфигурации</p>
		<pre>
			<code>$ webpack --config ./configs/site.js</code>
			<code>$ webpack --config ./configs/admin.js</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Режим наблюдения за исходниками</h2>
		<pre><code>$ webpack --watch</code></pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Сервер разработки с горячей перезагрузкой</h2>

	</div>
</section>


<section class="slide shout">
	<div>
		<h2>Пишем свой загрузчик</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Пишем свой загрузчик</h2>
		<pre>
			<code>module.exports = function (content) {</code>
			<code>  this.cacheable();</code>
			<code>  return transform(content);</code>
			<code>};</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Пишем свой загрузчик</h2>
		<pre>
			<code>module.exports = function (content, map) {</code>
			<code>  var callback = this.async();</code>
			<code>  transformAsync(content, map, callback);</code>
			<code>  // callback(err, result, map); </code>
			<code>};</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Пишем свой загрузчик</h2>
		<pre>
			<code>module.exports = function (content) {</code>
			<code>  var callback = this.async();</code>
			<code>  var externalFile = path.resolve(&quot;stuff.js&quot;);</code>
			<code>  this.addDependency(externalFile);</code>
			<code>  appendExternalFile(content, externalFile, callback);</code>
			<code>};</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Опции загрузчика</h2>
		<p>Передаются в виде строки запроса при описании загрузчика.</p>
		<pre><code>require("loader?with=parameter!./file");</code></pre>
		<p>Как правило, загрузчики пользуются модулем
			<a href="https://github.com/webpack/loader-utils" target="_blank">loader-utils</a>
			для разбора параметров.</p>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Опции загрузчика</h2>
		<p>Можно указать в виде свойства объекта конфигурации webpack.</p>
		<pre>
			<code>module.exports = {</code>
			<code>  yourAwesomeLoader: {</code>
			<code>    // тут будет конфигурация загрузчика</code>
			<code>  }</code>
			<code>};</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Опции загрузчика</h2>
		<pre>
			<code>var query = loaderUtils.parseQuery(this.query);</code>
			<code>var configKey = query.config || "yourAwesomeLoader";</code>
			<code>var config = this.options[configKey];</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Документация по загрузчикам</h2>
		<ol>
			<li><a href="http://webpack.github.io/docs/loaders.html" target="_blank">Loaders</a></li>
			<li><a href="http://webpack.github.io/docs/how-to-write-a-loader.html" target="_blank">How to write a loader</a></li>
			<li><a href="http://webpack.github.io/docs/list-of-loaders.html" target="_blank">List of loaders</a></li>
		</ol>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Плагины</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Плагины</h2>
		<ul>
			<li>имеют доступ ко всем модулям (до и после трансформации);</li>
			<li>могут добавлять в упаковку свои модули (например, &laquo;runtime&raquo;);</li>
			<li>имеют доступ ко всем ресурсам, создаваемым после упаковки.</li>
			<li>применяются для изменения конфигурации сборки, оптимизации, добавления в модули каких-то объектов, горячего обновления ресурсов.</li>
		</ul>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Документация по плагинам</h2>
		<ol>
			<li><a href="http://webpack.github.io/docs/plugins.html" target="_blank">Plugins</a></li>
			<li><a href="http://webpack.github.io/docs/list-of-plugins.html" target="_blank">List of plugins</a></li>
		</ol>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Примеры из жизни</h2>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Несколько точек входа</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Несколько точек входа</h2>
		<pre>
			<code>entry: {</code>
			<code>  &quot;site&quot;: &quot;./site&quot;,</code>
			<code>  &quot;admin&quot;: &quot;./admin&quot;</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Несколько точек входа</h2>
		<pre>
			<code>output: {</code>
			<code>  filename: &quot;[name].js&quot;,</code>
			<code>  chunkFilename: &quot;[id].js&quot;</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Несколько точек входа</h2>
		<pre>
			<code>output: {</code>
			<code>  path: require(&quot;path&quot;).resolve(&quot;./public/_/&quot;),</code>
			<code>  publicPath: &quot;/assets/&quot;,</code>
			<code>  filename: &quot;[name].js&quot;,</code>
			<code>  chunkFilename: &quot;[id].js&quot;</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Общая часть</h2>
		<pre>
			<code>plugins: [</code>
			<code>  new webpack.optimize.CommonsChunkPlugin({</code>
			<code>    name: &quot;commons&quot;,</code>
			<code>  })</code>
			<code>]</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Автоматическо разделение кода и асинхронная загрузка частей</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Code splitting</h2>
		<pre>
			<code>require.ensure(</code>
			<code>  [&quot;jquery&quot;, &quot;lodash&quot;],</code>
			<code>  function (require) {</code>
			<code>    var jquery = require(&quot;jquery&quot;);</code>
			<code>  }</code>
			<code>);</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Code splitting</h2>
		<pre>
			<code>define(</code>
			<code>  [&quot;jquery&quot;, &quot;lodash&quot;],</code>
			<code>  function (jquery, lodash) {</code>
			<code>    // ...</code>
			<code>  }</code>
			<code>);</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>bundle-loader</h2>
		<pre>
			<code>var waitForChunk = require('bundle!./page');</code>
			<code>waitForChunk(function (page) {</code>
			<code>  page.init();</code>
			<code>});</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>bundle-loader</h2>
		<pre>
			<code>var waitForChunk = require('bundle?<mark>lazy</mark>!./page');</code>
			<code>waitForChunk(function (page) {</code>
			<code>  page.init();</code>
			<code>});</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Некешируемый загрузчик приложения</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Некешируемый загрузчик приложения</h2>
		<p><strong>Идея:</strong> На странице подключается только файл main.js,
			который загружает весь остальной код.</p>
		<p class="next"><strong>Проблема:</strong> Код приложение должен максимально
			эффективно кешироваться браузером.</p>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Некешируемый загрузчик приложения</h2>
		<ol>
			<li>для <strong>main.js</strong> запрещаем кеширование;</li>
			<li>для остальных файлов устанавливаем заголовок <code>Expires</code> в далёкое будущее;</li>
			<li>используем &laquo;code splitting&raquo; и случайные имена упаковок в webpack.</li>
		</ol>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Некешируемый загрузчик приложения</h2>
		<p>Можно пользователю показать индикатор загрузки.</p>
	</div>
</section>

<section class="slide cover w">
	<div>
		<img src="assets/main-and-chunks.png">
	</div>
</section>

<section class="slide">
	<div>
		<h2>Загрузка по условию</h2>
		<pre>
			<code>new webpack.optimize.CommonsChunkPlugin({</code>
			<code>  children: true,</code>
			<code>  async: true</code>
			<code>})</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Подавляем ненужные ресурсы</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Подавляем ненужные ресурсы</h2>
		<pre>
			<code>new webpack.ContextReplacementPlugin(</code>
			<code>  /moment[\/\\]locale$/,</code>
			<code>  /en-gb|ru/</code>
			<code>)</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Подавляем ненужные ресурсы</h2>
		<pre>
			<code>new webpack.IgnorePlugin(</code>
			<code>  /moment[\/\\]locale$/,</code>
			<code>  /en-gb|ru/</code>
			<code>)</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Сервер для разработки и горячее обновление</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Сервер для разработки</h2>
		<pre>
			<code>$ webpack-dev-server --content-base ./public/_/</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Горячее обновление модулей</h2>
		<p>Почти как live-reload.</p>
		<p class="next">Загрузчик модулей может заменять отдельные модули.</p>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Плагины для горячего обновления</h2>
		<pre>
			<code>plugins: {</code>
			<code>  new webpack.optimize.OccurenceOrderPlugin(),</code>
			<code>  new webpack.HotModuleReplacementPlugin(),</code>
			<code>  new webpack.NoErrorsPlugin()</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>Бонус: запуск&nbsp;задач</h2>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Запуск задач</h2>
		<pre>
			<code>$ npm run clean</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>$ npm run clean</h2>
		<pre>
			<code>{</code>
			<code>  &quot;scripts&quot;: {</code>
			<code>    &quot;clean&quot;: &quot;rm -rf ./public/_&quot;</code>
			<code>  }</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Запуск задач</h2>
		<pre>
			<code>$ npm run build:site</code>
			<code>$ npm run build:admin</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>$ npm run build:site</h2>
		<pre>
			<code>{</code>
			<code>  &quot;scripts&quot;: {</code>
			<code>    &quot;build:site&quot;: &quot;./node_modules/.bin/webpack &hellip;</code>
			<code>    &quot;build:admin&quot;: &quot;./node_modules/.bin/webpack &hellip;</code>
			<code>  }</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>Запуск задач</h2>
		<pre>
			<code>$ npm run myCoolJavaScript</code>
		</pre>
	</div>
</section>

<section class="slide">
	<div>
		<h2>$ npm run myCoolJavaScript</h2>
		<pre>
			<code>{</code>
			<code>  &quot;scripts&quot;: {</code>
			<code>    &quot;myCoolJavaScript&quot;: &quot;node my-cool-javascript.js&quot;</code>
			<code>  }</code>
			<code>}</code>
		</pre>
	</div>
</section>

<section class="slide shout">
	<div>
		<h2>С погружением!</h2>
	</div>
</section>

<section class="slide" id="contacts">
	<div>
		<h2>Владимир Кузнецов</h2>
		<p>
			<img src="assets/twitter.svg" class="icon">
			<a href="http://twitter.com/mistakster" target="_blank">@mistakster</a> (English)<br>
			<img src="assets/twitter.svg" class="icon">
			<a href="http://twitter.com/mista_k" target="_blank">@mista_k</a> (больше про жизнь)
		</p>
		<p>
			<img src="assets/globe.svg" class="icon">
			<a href="http://noteskeeper.ru" target="_blank">noteskeeper.ru</a>
		</p>
		<p>Слайды презентации: <a href="http://mistakster.github.io/fronttalks-webpack/">mistakster.github.io/fronttalks-webpack</a>
	</div>
</section>

<div class="progress"><div></div></div>

<script src="shower/shower.min.js"></script>
<!-- Copyright © 2015 Владимир Кузнецов -->
</body>
</html>
